# CrewAI Configuration
# Copy this file to .env and fill in your values

# OpenAI API Key (or your preferred LLM provider)
# CrewAI supports multiple providers: OpenAI, Anthropic, Azure, etc.
# See: https://docs.crewai.com/en/concepts/llms#setting-up-your-llm
OPENAI_API_KEY=sk-your-api-key-here

# Alternative: Anthropic API Key
# ANTHROPIC_API_KEY=sk-ant-your-api-key-here

# Alternative: Azure OpenAI
# AZURE_API_BASE=https://your-resource.openai.azure.com
# AZURE_API_KEY=your-azure-api-key-here
# AZURE_API_VERSION=2024-02-15-preview
# AZURE_DEPLOYMENT_NAME=gpt-4

# Serper API Key (for web search tools, if needed)
# SERPER_API_KEY=your-serper-api-key-here

# CrewAI Settings
# CREWAI_PROCESS_MODE=sequential
# CREWAI_VERBOSE=true

# Optional: Custom Model Configuration
# CREWAI_LLM=openai/gpt-4
# CREWAI_TEMPERATURE=0.7

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================

# Database URL - supports SQLite and PostgreSQL
# SQLite (default): file-based, no server required
DATABASE_URL=sqlite:///./feature_dev.db

# PostgreSQL: production-ready, requires running PostgreSQL server
# Automatically uses JSONB for JSON columns
# DATABASE_URL=postgresql+psycopg2://user:password@localhost:5432/feature_dev

# Enable SQL query logging (useful for debugging)
# DATABASE_ECHO=true

# =============================================================================
# WEBHOOK CONFIGURATION
# =============================================================================

# Webhook timeout in seconds (default: 10)
# WEBHOOK_TIMEOUT=10

# =============================================================================
# DATABASE SCHEMA
# =============================================================================
#
# Tables:
#
# 1. flow_execution - Main flow run record
#    - id, flow_id (unique), issue_id, task, repo, branch
#    - current_phase, verified, tested
#    - build_cmd, test_cmd, ci_notes, baseline, findings
#    - current_story_id, current_story_title
#    - pr_url, pr_number, review_status, diff
#    - commit_title, commit_message, commit_footer
#    - changes (JSON), tests (JSON)
#    - created_at, updated_at
#
# 2. story - Individual user stories
#    - id, story_id, title, description
#    - acceptance_criteria (JSON/JSONB)
#
# 3. flow_story - Junction table (stories planned for a flow)
#    - id, flow_id -> flow_execution.id, story_id -> story.id, order
#
# 4. completed_story - Junction table (stories completed in a flow)
#    - id, flow_id -> flow_execution.id, story_id -> story.id
#    - completed_at, changes, tests
#
# 5. phase_snapshot - State at each phase transition
#    - id, flow_id -> flow_execution.id, phase
#    - state_json (JSON/JSONB), created_at
#
# 6. webhook_config - Webhook endpoints
#    - id, name, url, events (JSON list), active
#
# =============================================================================
# WEBHOOK USAGE
# =============================================================================
#
# Webhooks are configured in the database via webhook_config table.
#
# Example: Insert a webhook via SQL
# INSERT INTO webhook_config (name, url, events, active)
# VALUES ('slack-notify', 'https://hooks.slack.com/services/...', '["review", "create_pr"]', 1);
#
# Available phases: setup, plan_task, create_branch, implement_story,
#                   test_integration, verify, commit_changes, create_pr, review
# Use "*" to trigger on all phases
#
# Webhook payload format:
# {
#   "phase": "review",
#   "webhook_name": "slack-notify",
#   "state": { ... full FeatureDevState as dict ... }
# }
